name: Prepare VS Code Core Runtime
description: Build and verify @zpl-toolchain/core runtime artifacts for extension workflows

runs:
  using: composite
  steps:
    - name: Build WASM package for @zpl-toolchain/core
      shell: bash
      run: wasm-pack build crates/wasm --target bundler --out-dir ../../packages/ts/core/wasm/pkg

    - name: Install dependencies and build @zpl-toolchain/core
      shell: bash
      run: |
        cd packages/ts/core
        npm ci
        npm run build

    - name: Verify core runtime artifacts exist
      shell: bash
      run: |
        test -f packages/ts/core/wasm/pkg/zpl_toolchain_wasm_bg.wasm
        test -f packages/ts/core/dist/index.js
